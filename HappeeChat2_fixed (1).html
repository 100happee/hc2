<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HappeeChat2</title>
<link rel="icon" href="https://i1.sndcdn.com/avatars-V22Gw2FsnsI9xMuU-ihNrRA-t240x240.jpg" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0e12;--panel:#0f1419;--muted:#8b97a6;--accent:#4da3ff;
    --contrast:#12161a;--bubble:#0e1317;--mention:#f5d35b;--mention-text:#1a1a1a;
    font-family: 'Poppins', sans-serif;
  }
  html,body{height:100%;margin:0;background:#04060a;color:#e6eef6}
  .app {height:100vh;display:flex;gap:12px}
  /* Removed left column entirely */
  .middle {
    width:260px;background:var(--panel);padding:12px;display:flex;flex-direction:column;gap:8px;box-sizing:border-box;
  }
  .chat-list {overflow:auto;flex:1;padding-top:6px}
  .chat-item {display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
  .chat-item:hover{background:rgba(255,255,255,0.02)}
  .chat-item img {width:44px;height:44px;border-radius:8px;object-fit:cover}
  .chat-item .meta {display:flex;flex-direction:column}
  .chat-item .meta .name {font-weight:600}
  .unread-count {margin-left:auto;background:#2b6aab;padding:4px 6px;border-radius:6px;font-size:12px}
  .right {flex:1;background:var(--contrast);display:flex;flex-direction:column;padding:12px;box-sizing:border-box}
  .header {display:flex;align-items:center;gap:12px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.02);}
  .header .title {font-size:18px;font-weight:700}
  .header .controls {margin-left:auto;display:flex;gap:8px;align-items:center}
  .btn {background:var(--accent);color:#06121a;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04)}
  .read-btn{background:#334153;color:white;padding:6px 8px;border-radius:8px}
  .volume {display:flex;align-items:center;gap:8px}
  .volume input[type=range]{width:120px}
  .messages {flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:12px}
  .message {display:flex;gap:12px;align-items:flex-start;padding:8px;border-radius:8px;transition:background 120ms}
  .message:hover{background:rgba(255,255,255,0.03)}
  .message .avatar {width:48px;height:48px;border-radius:8px;object-fit:cover}
  .message .body {flex:1}
  .message .meta {display:flex;gap:8px;align-items:center}
  .message .username{font-weight:700}
  .message .text{margin-top:6px;white-space:pre-wrap}
  .message .timestamp{font-size:11px;color:var(--muted);margin-left:auto}
  .mention {background:var(--mention);color:var(--mention-text);padding:2px 6px;border-radius:6px}
  .atlink {color:var(--accent);font-weight:700}
  .file-embed {margin-top:8px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);padding:6px;background:#070a0c}
  .input-row {display:flex;gap:8px;align-items:center;padding-top:8px;border-top:1px solid rgba(255,255,255,0.02)}
  .input-row textarea{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;min-height:44px;max-height:120px;resize:none}
  .input-row .add-btn{width:44px;height:44px;border-radius:8px;border:1px dashed rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer}
  .login-overlay{position:absolute;inset:0;background:rgba(3,6,9,0.9);display:flex;align-items:center;justify-content:center;z-index:9999}
  .login-box{width:760px;background:#07101a;padding:18px;border-radius:12px;display:flex;gap:12px;box-sizing:border-box}
  .login-left{width:320px;padding:8px;display:flex;flex-direction:column;gap:8px}
  .account {display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;cursor:pointer}
  .account img{width:48px;height:48px;border-radius:8px;object-fit:cover}
  .create-form{flex:1;padding:8px;display:flex;flex-direction:column;gap:8px}
  .danger{background:#ff6b6b;color:white}
  .admin-delete {margin-left:auto;background:#7b2634;color:#fff;padding:6px;border-radius:8px;border:none;cursor:pointer}
  .mentioned {background:linear-gradient(90deg,#3b2b03,#5a4710);border-radius:8px}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="middle">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div style="font-weight:700">Chats</div>
      <div class="small" id="online-count">0 online</div>
    </div>
    <div class="chat-list" id="chat-list"></div>
  </div>

  <div class="right">
    <div class="header">
      <div class="title" id="chat-title">Public Chat</div>
      <div class="controls" id="header-controls">
        <div class="small">Ping vol</div>
        <div class="volume"><input id="volume-slider" type="range" min="0" max="100" value="70"/></div>
        <button id="read-messages" class="read-btn small">Read Messages</button>
        <button id="logout" class="btn ghost small">Logout</button>
      </div>
    </div>
    <div class="messages" id="messages"></div>
    <div class="input-row">
      <label class="add-btn" id="attach-btn">+</label>
      <input type="file" id="file-input" style="display:none" />
      <textarea id="txt-message" placeholder="Write a message..."></textarea>
      <button id="send-btn" class="btn">Send Message</button>
    </div>
  </div>
</div>

<div class="login-overlay" id="login-overlay">
  <div class="login-box">
    <div class="create-form">
      <div style="font-weight:700">Create new account</div>
      <input id="new-username" placeholder="username" />
      <input id="new-password" type="password" placeholder="password" />
      <input id="avatar-file" type="file" accept="image/*" />
      <button id="create-account" class="btn">Create account</button>
      <div id="login-msg" class="small"></div>
      <div style="font-weight:700;margin-top:12px">Existing accounts</div>
    </div>
    <div class="login-left">
      <div style="font-size:18px;font-weight:800">Welcome to HappeeChat2</div>
      <div id="accounts-list" style="margin-top:12px;overflow:auto"></div>
    </div>
  </div>
</div>

<audio id="ping-audio" src="./ping.mp3" preload="auto"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, onValue, set, push, remove, get, update } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

const firebaseConfig={apiKey:"AIzaSyDkpDlINFiUzR0PsFRcxxk-N2fhHLnpACI",authDomain:"hchat2-1d004.firebaseapp.com",databaseURL:"https://hchat2-1d004-default-rtdb.firebaseio.com",projectId:"hchat2-1d004",storageBucket:"hchat2-1d004.firebasestorage.app",messagingSenderId:"807685526215",appId:"1:807685526215:web:6b9042099ff0b464be24e2"};
const app=initializeApp(firebaseConfig);const db=getDatabase(app);

/* --- YOUTUBE EMBED FIX --- */
function formatTextWithLinksAndMentions(text=''){
  if(!text) return '';
  let safe=text.replace(/[&<>"']/g,(m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  // links
  safe=safe.replace(/(https?:\/\/[^\s]+)/g,(m)=>`<a href="${m}" target="_blank" style="color:#4da3ff">${m}</a>`);
  // mentions
  safe=safe.replace(/@([a-zA-Z0-9\-_]+)/g,(m,u)=>`<span class="atlink">@${u}</span>`);
  // YouTube embed below link
  const ytRegex=/(https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_\-]+))/ig;
  safe=safe.replace(ytRegex,(match,full,id)=>{
    return `<a href="${match}" target="_blank" style="color:#4da3ff">${match}</a><div style="margin-top:6px"><iframe width="420" height="236" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe></div>`;
  });
  return safe;
}
</script>
</body>
</html>
